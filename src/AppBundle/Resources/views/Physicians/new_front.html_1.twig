{% extends '::basecropingimage.html.twig' %}

{% trans_default_domain 'FOSUserBundle' %}
{% block body -%}
    <div class="row" style="height:80%; ">
        <!--<div class="col-xs-7 col-lg-8 modbg_izq" >
            <div class="imagenRegistroMedico"></div>
        </div>modbg_izq-->
        <div class="col-xs-12 col-lg-12 col-md-12 modpq_der modpq_acercade" style="height:100%; " >
            <div class="docHomeIntScroll mCustomScrollbar">
                {{ form_start(form,{'attr': {'class': 'registerFrontM','id': 'registerPhysician'}}) }}
                <div class="registroFormulario" style="height:100%; " style="margin:-6% 0 0 0;">
                    <h3>{{'layout.create.account'|trans({}, 'AppBundle')}}</h3>
                    <div style="margin-top:-5%;">
                        {% set e=form_errors(form) %}
                        {% if (e !='') %}
                        <div class="errors cuadro uno cuadroError">
                            <p>{{ form_errors(form) }}</p>
                        </div>
                        {%endif%}
                        <div class="col-lg-8 col-md-8 col-xs-8 rightCol">                            
                            <div class="registroCampo doble">
                                <div class="campoRight dos">
                                    {{ form_row(form.user.name) }}
                                </div><!--campoRight-->
                                <div class="campoLeft dos">
                                    {{ form_row(form.user.lastname) }}
                                </div><!--campoLeft-->
                            </div><!--registroCampo doble-->     
                            <div class="registroCampo doble">
                                <div class="campoRight dos">
                                    {{ form_row(form.user.email) }}
                                </div><!--campoRight-->
                                <div class="campoLeft dos">
                                    {{ form_row(form.user.username) }}
                                </div><!--campoLeft-->
                            </div><!--registroCampo doble-->                                    
                            <div class="registroCampo doble pass">

                                <div  class="campoRight dos">
                                    <label class="">Contraseña:</label>                                 
                                    {{ form_widget(form.user.plainPassword.first, {'attr': { 'pattern':"(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,}",'title':"La contraseña debe contener al menos 6 caracteres, incluyendo MAYUSCULA/minúscula y números"} }) }}
                                    {% for errorItem in form.user.plainPassword.first.vars.errors %}
                                        <label class="control-label has-error" for="{{ form.user.plainPassword.vars.id }}">{{ errorItem.message }}</label>
                                    {% endfor %}
                                </div>     
                                <div class="campoLeft dos ">
                                    <label class="">Repita la contraseña:</label>                                    
                                    <div>
                                        {{ form_widget(form.user.plainPassword.second, {'attr': {'pattern':"(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,}",'title':"La contraseña debe contener al menos 6 caracteres, incluyendo MAYUSCULA/minúscula y números"} }) }}
                                    </div>    
                                </div>   
                            </div>                            
                            <div class="registroCampo doble">
                                <div class="campoRight dos">
                                    {{ form_row(form.jobtitle) }}
                                </div><!--registroCampo-->
                                <div class="campoLeft dos">
                                    {{ form_row(form.abms) }}
                                </div><!--registroCampo-->
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-xs-4">
                            <div class="registroCampo doble">
                                {{ form_label(form.photo) }}
                                <div class="photoFront">
                                    {{ form_widget(form.photo) }}
                                </div>
                            </div><!--registroCampo doble-->
                        </div>

                        <div class="registroCampo doble clearFix">
                            <div class="campoRight dos">
                                {{ form_row(form.education) }}
                            </div><!--campoRight-->
                            <div class="campoLeft dos">
                                {{ form_row(form.university) }}
                            </div><!--campoLeft-->
                        </div><!--registroCampo doble-->
                        <div class="registroCampo doble">
                            <div class="campoRight dos">
                                {{ form_row(form.specialty) }}
                            </div><!--campoRight-->
                            <div class="campoLeft dos">
                                {{ form_row(form.subspecialty) }}
                            </div><!--campoLeft-->
                        </div><!--registroCampo doble-->
                        <div class="registroCampo">
                            {{ form_row(form.research) }}
                        </div><!--registroCampo-->                        

                        <div class="registroCampo doble">
                            <div class="campoRight dos">
                                <div class="registroCampo doble">
                                    <div class="campoRight tres">
                                        {{ form_row(form.languages) }}    
                                    </div><!--campoRight-->
                                    <div class="campoLeft tres">
                                        {{ form_row(form.postalcode) }}              
                                    </div><!--campoLeft-->
                                </div><!--registroCampo doble-->

                            </div><!--campoIzquierdo-->
                            <div class="campoLeft dos">
                                <div class="registroCampo doble">                                   
                                    <div class="campoRight tres">
                                        {{ form_row(form.timezone) }}    
                                    </div><!--campoRight-->
                                    <div class="campoLeft tres">
                                        {{ form_row(form.phone) }}              
                                    </div><!--campoLeft-->
                                </div><!--registroCampo-->
                            </div><!--campoDerecho-->
                        </div><!--campoEspecial-->
                        <div class="campoEspecial">
                            <div class="campoIzquierdo"><p class="letraPequena">{{'layout.create.msj_bottom2'|trans({}, 'AppBundle')}} <br> <span  class="colorLilaOscuro">{{'layout.create.msj_bottom1'|trans({}, 'AppBundle')}}</span> </p><!--letraPequena--></div><!--campoIzquierdo-->
                            <div class="campoDerecho text-right"><input type="submit" value="{{'layout.create.btn_submit'|trans({}, 'AppBundle')}}" class="submit lilaOscuro"></div><!--campoDerecho-->
                        </div><!--campoEspecial-->
                    </div>
                </div><!--registroFormulario tres-->
                {{ form_end(form) }}
            </div>
        </div><!--modpq_der modpq_acercade-->
    </div><!--row-->
    <div class="row" style="height:10%; ">
        <div class="col-xs-12 barrafooter barraf_registro">
            <ul>
                <li class="current"><a href="#">{{'layout.registration'|trans({}, 'AppBundle')}}</a><div class="arrow registro"></div></li>
            </ul>
        </div><!--barrafooter barraf_registro-->
    </div><!--row-->

{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
        $(document).ready(function () {
            $('#appbundle_physicians_specialty option[value="3"]').remove();
            $("label.required").each(function () {
                $(this).html($(this).html() + "*");
            });
            $("#appbundle_physicians_user").parent().find("label").remove();

            var form = document.getElementById('registerPhysician');
            form.addEventListener('submit', function (event) {

                if (this.checkValidity()) {

                    var path = '{{ path("physicians_verify", {'email': '_e', 'username': '_u'}) }}';
                    path = path.replace("_e", $("#appbundle_physicians_user_email").val());
                    path = path.replace("_u", $("#appbundle_physicians_user_username").val());
                    $.getJSON(path, function (data) {

                        if (data.email === true || data.username === true) {
                            if (data.email === true)
                                $(".errors").html("{{'form.emailexist'|trans({}, 'AppBundle')}}");
                            if (data.username === true)
                                $(".errors").html("{{'form.userexist'|trans({}, 'AppBundle')}}");
                            event.preventDefault();
                        } else {
                            $(".register-profile").show();
                            $(".register-user").hide();
                            $("#fieldsPatient").removeAttr("disabled");
                            btncont = false;
                        }
                    });


                }

            }, false);

            $('.submit').click(function () {               
                if ($("#appbundle_physicians_user_plainPassword_first").val() !== $("#appbundle_physicians_user_plainPassword_second").val()) {
                    $("#appbundle_physicians_user_plainPassword_second").focus();
                    document.getElementById("appbundle_physicians_user_plainPassword_second").setCustomValidity("Por favor, introduzca la misma contraseña.");                    
                } else {
                    document.getElementById("appbundle_physicians_user_plainPassword_second").setCustomValidity("");
                }
            });


        });
    </script>


{% endblock %}

